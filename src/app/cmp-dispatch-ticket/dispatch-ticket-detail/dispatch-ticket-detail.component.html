<div class="card">
  <h3><i class="fa fa-credit-card" aria-hidden="true"></i>
     Dispatch Ticket Detail</h3>
  <nav class="navbar bg-light-blue">
  <div class="btn-group" role="group">
    <button *ngIf="this.currentUser.authRules.isDispatcherManager === true" class="btn btn-primary" (click)="onEdit()">Edit Dispatch ticket</button>
  </div>
  <div class="btn-group" role="group">

 <!--    <button 
    ngbTooltip="Change the status from (open) to (Withdraw) by Treasurer " triggers="mouseenter:mouseleave" popoverTitle="Withdraw" container="body" 
     *ngIf="this.currentUser.authRules.isTreasurer === true" 
     class="btn btn-light" (click)="onWithdraw()">Withdraw</button> -->

  <button 
    ngbTooltip="Change the status from (withdraw) to (recieved) by Vaulter " triggers="mouseenter:mouseleave" popoverTitle="Recieved" container="body"
     *ngIf="this.currentUser.authRules.isAtmVaulter === true" 
     class="btn btn-warning" (click)="onReveived()">Recieved</button>

   <!--  <button
     ngbTooltip="
      Change the status to (closed) by Treasurer when recieved return money or Bad bill from vaulter.
     " triggers="mouseenter:mouseleave" popoverTitle="Return Recieved" container="body"
     *ngIf="this.currentUser.authRules.isTreasurer === true" 
     class="btn btn-danger" (click)="onRevieved()">Closed</button> -->
</div>
  </nav>
  <div class="card-body">
  <ul class="list-group list-group-flush">
    <li class="list-group-item">
      <h4>Dispatch Ticket ID : {{ dt.dtID }}</h4>
      <small>Dispatch Ticket status : </small><span class="badge badge-pill" ngClass="{{dt.dtStatus}}">
    {{ dt.dtStatus }}
    </span>
    <div class="pull-right">
      <i class="fa fa-calendar-check-o" aria-hidden="true"></i>
      <small class="text-muted">updated: {{dt.updated |  date:'medium' }}</small><br>
      <i class="fa fa-calendar" aria-hidden="true"></i>
      <small class="text-muted">created: {{dt.created | date:'medium' }}</small>
    </div>
    </li>
    <li class="list-group-item">
      <h4>Responsible Person</h4>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>#</th>
            <th>Vaulter Name</th>
            <th>
              <span class="pull-right">Phones</span>

            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let rp of dt.dtResponsiblePersons; let i = index;">
            <td>{{i+1}}</td>
            <td>{{rp.fullName}}</td>
            <td>
              <div class="pull-right">
                <a class="caption" *ngFor="let p of rp.userPhones" href="tel:{{p.number}}"><i class="fa fa-phone" aria-hidden="true"></i> {{ p.desc }}:{{p.number}}</a>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </li>
    <li class="list-group-item">
      <h4 class=""> Services ATM Machine</h4>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>#</th>
            <th>Atm Machine ID</th>
            <th>Remaining Balance</th>
            <th>Atm Status</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let at of dt.dtAtms;let i = index;">
            <td>{{i+1}}</td>
            <td>{{at.atm.atmMachineID}}</td>
            <td>{{at.atm.atmBalance | currency:'USD':true}}</td>
            <td>{{at.atm.atmStatus}}</td>
          </tr>
        </tbody>
      </table>
    </li>
    <li class="list-group-item">
      <div class="row">
        <div class="col-md-12">
          <app-dispatch-map-with-markers
           [atms]="dt.dtAtms" >
          </app-dispatch-map-with-markers>
        </div>

      </div>

    </li>
    <li class="list-group-item">
      <h4> TechnicianTicket </h4>
      <span *ngIf="!dt.dtTechnicianTickets?.length">- no technician ticket for this Dispatch Ticket. -</span>

      <div class="row">
        <div class="col-md-12">
        <div class="card-deck">
          <div class="card" *ngFor="let tt of dt.dtTechnicianTickets">
            <div class="card-title">
              <h5 class="card-title">#{{tt.tTicketID}}</h5>
            </div>
            <div class="card-body">
              <span class="badge badge-pill" ngClass="{{tt.tTicketStatus}}">
            {{ tt.tTicketStatus }}
            </span>
              <strong>Symptom:</strong>
              <p class="card-text">
                {{ tt.tTicketSymptom }}
              </p>
              <strong>Solution:</strong>
              <p class="card-text">
                {{ tt.tTicketSolution }}
              </p>
              <strong>Atm Machine:</strong>
              <p class="card-text">
                {{ tt.atmMachineID }}
              </p>
              <strong>Responsible Person:</strong>
              <p class="card-text">
                {{ tt.tTicketResponsiblePerson?.fullName }}
              </p>

            </div>
            <div class="card-footer">
              <i class="fa fa-calendar-check-o" aria-hidden="true"></i>
              <small class="text-muted">updated: {{tt.updated |  date:'medium' }}</small><br>
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <small class="text-muted">created: {{tt.tTicketCreated | date:'medium' }}</small>
            </div>

          </div>
        </div>
        </div>

      </div>
    </li>

    <li class="list-group-item">

    </li>

  </ul>
</div>
